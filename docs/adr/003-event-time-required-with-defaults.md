# ADR-003: イベント時間を必須化し、フォームにデフォルト値を設定する

## ステータス

**承認** (2026-02)

## コンテキスト

イベントの構造化フィールドとして `openTime`（開場時間）と `startTime`（開始時間）を追加した。当初は既存データとの後方互換性のため nullable（optional）として設計した。

しかし運用上、**時間が決まっていないイベントは存在しない**。すべてのイベントには開場・開始時間がある。また、最も一般的なパターンは **19:00 open / 20:00 start** の夜イベントである。

### 現状の問題

1. **ドメインモデルと実態の乖離**: nullable だが、実際には常に値が存在する
2. **入力の手間**: 毎回同じ値（19:00 / 20:00）を手入力する必要がある
3. **null チェックの連鎖**: 表示側で毎回 null ガードが必要

## 決定

### 1. バリデーションスキーマで openTime / startTime を必須にする

`optional().nullable()` → 必須の HH:mm 文字列に変更する。

### 2. フォームの defaultValues に 19:00 / 20:00 を設定する

新規作成フォームでは開場 19:00、開始 20:00 をプリセットし、変更したい場合のみ Select で選び直す。

### 3. DB カラムは nullable のまま維持する

既存データに null が含まれる可能性があるため、DB レベルでは NOT NULL 制約を追加しない。アプリケーション層（バリデーション）で必須を担保する。

## 決定理由

| 要因 | 判断 |
|------|------|
| ビジネス実態 | 時間未定のイベントは存在しない → 必須が正しい |
| 入力効率 | 8割以上が19:00/20:00 → デフォルト値で省力化 |
| 後方互換性 | DB は nullable のまま → 既存データへの影響なし |
| 段階的移行 | 将来的に既存データを埋めた後、DB にも NOT NULL を適用可能 |

## 影響

### 変更対象

| レイヤー | 変更内容 |
|---|---|
| バリデーション | `timeStringSchema` から `.optional().nullable()` を除去 |
| ドメインエンティティ | `openTime`, `startTime` の型を `string`（nullable除去）に変更 |
| フォーム defaultValues | `openTime: "19:00"`, `startTime: "20:00"` に設定 |
| UI (Select) | placeholder ではなくデフォルト選択値として 19:00/20:00 を表示 |
| リポジトリ | toDomainEntity で null → デフォルト値のフォールバック追加 |

### 変更しない対象

| レイヤー | 理由 |
|---|---|
| DB スキーマ | 既存データの後方互換性のため nullable 維持 |
| cleanFormData | 空文字→null 変換は不要になる（常に値がある） |
