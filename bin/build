#!/bin/bash
# ãƒ­ãƒ¼ã‚«ãƒ«ãƒ“ãƒ«ãƒ‰ç¢ºèªç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
# Docker ã‚³ãƒ³ãƒ†ãƒŠå†…ã§ç’°å¢ƒå¤‰æ•°ã‚’å¾©å·åŒ–ã—ã¦ next build ã‚’å®Ÿè¡Œã™ã‚‹
# db:migrate ã¯ã‚¹ã‚­ãƒƒãƒ—ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ç¢ºèªã§ã¯ä¸è¦ï¼‰
#
# ä½¿ç”¨æ–¹æ³•: ./bin/build

set -euo pipefail

CONTAINER_RUNNING=$(docker compose ps --status running --services | grep app || true)

if [ -z "$CONTAINER_RUNNING" ]; then
  echo "â„¹ï¸  é–‹ç™ºã‚³ãƒ³ãƒ†ãƒŠãŒå®Ÿè¡Œã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ä¸€æ™‚çš„ãªã‚³ãƒ³ãƒ†ãƒŠã§å®Ÿè¡Œã—ã¾ã™..."
  echo "ğŸ”„ ãƒ“ãƒ«ãƒ‰ã‚’å®Ÿè¡Œä¸­..."
  docker compose run --rm app pnpm build:local
else
  echo "ğŸ”„ é–‹ç™ºã‚³ãƒ³ãƒ†ãƒŠå†…ã§ãƒ“ãƒ«ãƒ‰ã‚’å®Ÿè¡Œä¸­..."
  docker compose exec app pnpm build:local
fi
