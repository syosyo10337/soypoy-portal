#!/bin/bash
# 環境変数読み込みスクリプト
# コンテナ内（Dev Container、docker compose）・ホスト両方で動作
#
# 使用例:
#   ./bin/runenv next dev
#   ./bin/runenv drizzle-kit studio
#
# .env.local (個人設定) が .env.local.base (共有設定) を上書きする

# dotenvxコマンドを決定（グローバルにあればそれを、なければnpx経由）
if command -v dotenvx &> /dev/null; then
  DOTENVX="dotenvx"
else
  DOTENVX="npx @dotenvx/dotenvx"
fi

ENV_FILES=""

# 共有設定（暗号化）- 必須
if [ -f .env.local.base ]; then
  ENV_FILES="-f .env.local.base"
else
  echo "Error: .env.local.base not found"
  exit 1
fi

# 個人設定（平文、上書き）- オプション
if [ -f .env.local ]; then
  ENV_FILES="$ENV_FILES -f .env.local --overload"
fi

exec $DOTENVX run $ENV_FILES -- "$@"
